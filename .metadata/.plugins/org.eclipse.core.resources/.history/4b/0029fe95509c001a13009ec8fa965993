package com.XadrezLogica.main;

import java.io.File;
import java.util.Arrays;
import java.util.HashMap;
import java.util.HashSet;

import com.XadrezCompleto.padroes.ArquivosGerais;

public class Main {
	private final HashSet<String> chaves = new HashSet<String>(
			Arrays.asList(
					"Caminho Relativo:", 
					"Caminho do Plugin Apresentador:"
					)
			);

	public void main(String[] args) {
		File config = new File("config.txt");
		HashMap<String, String[]> elementos = new HashMap<String, String[]>();
		if (!config.exists()) {
			System.out.println("Preparando Configurações Padrão!");
			config.createNewFile();
			elementos.put("Caminho Relativo:", new String[] { "True" });
			elementos.put("Caminho do Plugin Apresentador:", new String[] { "Presenter.jar" });
			ArquivosGerais.setArgs(config, elementos);
		}
		elementos = ArquivosGerais.getArgs(config, chaves);
		//File localPlugin = new File("//home/artur/Desktop/pogramando/Plugins/Plugin.jar");
		File localPlugin=new File(elementos.get("Caminho do Plugin Apresentador:")[0]);
		if(!localPlugin.exists())throw new IllegalStateException("Favor adicionar plugin apresentador!");
		URLClassLoader child = new URLClassLoader(
				// new URL[] {new
				// URL("file:///home/artur/Desktop/pogramando/Plugins/Plugin.jar")},
				// Main.class.getClassLoader());
				new URL[] { new URL("jar", "", "file:" + file.getAbsolutePath() + "!/") }, Main.class.getClassLoader());

		System.out.println(child.getURLs()[0]);
		// Class clazz = child.loadClass("tentativaPlugin.Mensagem");
		Class<?> clazz = Class.forName("tentativaPlugin.Mensagem", true, child);
		System.out.println(clazz.getMethods());
		Method getMessage = clazz.getMethod("getMessage");
		Strint res = (Strint) getMessage.invoke(null);
		System.out.println(res.boi);
		System.out.println(res.foo);
	}
}
